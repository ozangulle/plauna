
{% extends "base.html" %}

{% block content %}

<h3 class="uppercase text-lg my-8">New Connection</h3>
<div class="flex flex-wrap gap-6">
  <form id="create" class="space-y-4" action="/admin/connections" method="POST">
    <input name="redirect-url" type="hidden" value="/admin/connections">
    <div class="flex gap-2">
      <label for="auth-type">Authentication</label>
      <div class="form-control">
        <select id="auth-select" class="select" name="auth-type">
          <option value="basic" {% if auth-type = "basic" %}selected{% endif %}>BASIC</option>
          <option value="oauth2" {% if auth-type = "oauth2" %}selected{% endif %}>OAUTH 2</option>
        </select>
      </div>
    </div>
    <div class="flex gap-2 oauth-related">
      <label for="auth-provider">Authentication Provider</label>
      <div class="form-control">
        <select class="select" name="auth-provider">
          <option value="" disabled {% if auth-provider = null %}selected{% endif %}>Please Select One</option>
          {% for provider in auth-providers %}
          <option value="{{provider.id}}" {% if auth-provider = id %}selected{% endif %}>{{provider.name}}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="flex gap-2">
      <label for="host">Host</label>
      <input class="input" name="host" value="{{host}}">
    </div>
    <div class="flex gap-2">
      <label for="user">User</label>
      <input class="input" name="user" value="{{user}}">
    </div>
    <div class="flex gap-2">
      <label for="secret">Secret</label>
      <input class="input" name="secret" type="password" value="{{secret}}">
    </div>
    <div class="flex gap-2">
      <label for="folder">Folder to watch</label>
      <input class="input" name="folder" value="{{folder}}">
    </div>
    <div class="flex gap-2">
      <label for="port">Port (defaults to default port of "security", leave empty if not sure)</label>
      <input class="input" name="port" value="{{port}}">
    </div>
    <div class="flex gap-2">
      <label for="security">Security</label>
      <div class="form-control">
        <select class="select" name="security">
          <option value="ssl" selected>SSL</option>
          <option value="starttls">STARTTLS</option>
          <option value="plain">PLAIN</option>
        </select>
      </div>
    </div>
    <div class="flex gap-2">
      <label for="check-ssl-certs">Check ssl certificates</label>
      <input class="checkbox" name="check-ssl-certs" type="checkbox" value="true" checked>
    </div>
    <div class="flex gap-2">
      <label for="debug">Debug mode</label>
      <input class="checkbox" name="debug" type="checkbox" value="true" {% if debug %} checked="true"{% endif %}>
    </div>
    <div class="form-field">
      <button form="create" class="btn btn-primary" type="submit">Create Connection</button>
    </div>  
  </form>

  <div class="grow-12 oauth-related">
    {% include "admin-provider.html" %}
  </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const select = document.getElementById('auth-select');
        const oauthGroup = Array.from(document.querySelectorAll('.oauth-related'));
        const oauthInputs = Array.from(oauthGroup.flatMap(el => Array.from(el.querySelectorAll('input, select, button'))));
        
        function updateOauthFields() {
            const enable = select.value === 'oauth2';
            oauthGroup.forEach(el => el.style.display = enable ? '' : 'none');
            oauthInputs.forEach(el => el.disabled = !enable);
        }
        
        updateOauthFields();
        select.addEventListener('change', updateOauthFields);
    });
</script>

{% endblock %}

